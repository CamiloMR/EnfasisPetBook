trigger:
- main

stages:
- stage: Build
  jobs:
  - job: Build

    pool:
      vmImage: 'vs2017-win2016'

    variables:
      sonarCloudToken: 'Service connection Sonar Cloud'
      sonarCloudOrganization: 'camilomr'
      sonarCloudProjectKey: 'camilomr'
      sonarCloudProjectName: 'PetBook'

    steps:
    - task: SonarSource.sonarcloud.14d9cde6-c1da-4d55-aa01-2965cd301255.SonarCloudPrepare@1
      displayName: 'Prepare analysis on SonarCloud'
      inputs:
        SonarCloud: $(sonarCloudToken)
        organization: $(sonarCloudOrganization)
        projectKey: $(sonarCloudProjectKey)
        projectName: $(sonarCloudProjectName)

    - task: Npm@1
      displayName: 'npm install'
      inputs:
        verbose: false
        
    - task: Npm@1
      displayName: 'npm build'
      inputs:
        command: custom
        verbose: false
        customCommand: 'run build'
      
    - task: SonarSource.sonarcloud.38b27399-a642-40af-bb7d-9971f69712e8.SonarCloudPublish@1
      displayName: 'Publish Quality Gate Result'

    - task: Npm@1
      displayName: 'npm test'
      inputs:
        command: custom
        verbose: false
        customCommand: 'run test-ci'
